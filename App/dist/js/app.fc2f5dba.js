(function(){"use strict";var e={5839:function(e,t,o){var n=o(9242),s=o(3396),i=o(7139);const r={id:"background"},a={class:"header"},l=(0,s._)("h1",{style:{color:"white"}},"MICROBLOGS",-1),d={id:"layout"},u={class:"maindiv max-w-sm rounded overflow-hidden shadow-lg"},c={key:0,id:"content"},g={id:"blogform"},h={class:"bg-white rounded px-8 pt-6 pb-8 mb-4"},p={key:1,id:"content"},f={key:2},m={key:0,class:"mapdiv rounded overflow-hidden shadow-lg"};function w(e,t,o,w,b,y){const v=(0,s.up)("BlogPost"),k=(0,s.up)("LoginPage"),x=(0,s.up)("NoteMap");return(0,s.wg)(),(0,s.iD)("div",r,[(0,s._)("div",a,[b.loggedin?((0,s.wg)(),(0,s.iD)("button",{key:0,style:{color:"white"},class:"button",onClick:t[0]||(t[0]=(...e)=>y.logout&&y.logout(...e))},"log out")):(0,s.kq)("",!0),l]),(0,s._)("div",d,[(0,s._)("div",u,[b.loggedin?((0,s.wg)(),(0,s.iD)("div",c,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(b.blogPosts,(e=>((0,s.wg)(),(0,s.j4)(v,{key:e.ID,text:e.text,index:b.blogPosts.indexOf(e),id:e.ID,onDelete:y.deletePost},null,8,["text","index","id","onDelete"])))),128)),(0,s._)("div",g,[(0,s._)("form",h,[(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>b.text=e),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",type:"text",onKeyup:t[2]||(t[2]=(0,n.D2)(((...e)=>y.addPost&&y.addPost(...e)),["enter"]))},null,544),[[n.nr,b.text]])]),(0,s._)("button",{onClick:t[3]||(t[3]=(...e)=>y.addPost&&y.addPost(...e)),class:"submitbutton bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",type:"button"}," submit ")])])):((0,s.wg)(),(0,s.iD)("div",p,[(0,s.Wm)(k,{csrfToken:b.csrfToken,onLogin:y.loginLoad,onRegister:y.loginLoad},null,8,["csrfToken","onLogin","onRegister"])])),b.loggedin&&b.pointToSet?((0,s.wg)(),(0,s.iD)("h1",f,(0,i.zw)(JSON.stringify(b.pointToSet.geometry.coordinates)),1)):(0,s.kq)("",!0)]),b.loggedin?((0,s.wg)(),(0,s.iD)("div",m,[(0,s.Wm)(x,{onSetPoint:y.setPoint},null,8,["onSetPoint"])])):(0,s.kq)("",!0)]),(0,s.Uk)(" "+(0,i.zw)(b.statusMessage),1)])}const b={id:"blogpost"};function y(e,t,o,n,r,a){return(0,s.wg)(),(0,s.iD)("li",b,[(0,s.Uk)((0,i.zw)(o.text)+" ",1),(0,s._)("button",{id:"buttonid",class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",onClick:t[0]||(t[0]=t=>e.$emit("delete",o.index,o.id))}," DEL ")])}var v={props:{text:String,id:Number,index:Number},methods:{}},k=o(89);const x=(0,k.Z)(v,[["render",y],["__scopeId","data-v-9687c7bc"]]);var T=x;const C={id:"login"},P={key:0,class:"hover:text-blue-600"},D={key:1,class:"hover:text-blue-600"};function S(e,t,o,r,a,l){return(0,s.wg)(),(0,s.iD)("div",C,[(0,s._)("h3",null,(0,i.zw)(a.errorMessage),1),(0,s._)("button",{onClick:t[0]||(t[0]=(...e)=>l.toggleLogin&&l.toggleLogin(...e))},[a.loginFlag?((0,s.wg)(),(0,s.iD)("a",D,"Don't have an account? Register for one now")):((0,s.wg)(),(0,s.iD)("div",P,"Already got an account? Log in"))]),(0,s._)("form",null,[(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>a.username=e),placeholder:"username",class:"mx-1 mt-3 shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"},null,512),[[n.nr,a.username]]),(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>a.password=e),placeholder:"password",class:"mx-1 my-3 shadow appearance-none border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"},null,512),[[n.nr,a.password]])]),a.loginFlag?((0,s.wg)(),(0,s.iD)("button",{key:0,onClick:t[3]||(t[3]=(...e)=>l.login&&l.login(...e)),class:"bg-white hover:bg-gray-100 font-semibold py-2 px-4 border rounded border-gray-400 shadow"},"Log In")):((0,s.wg)(),(0,s.iD)("button",{key:1,onClick:t[4]||(t[4]=(...e)=>l.register&&l.register(...e)),class:"bg-white hover:bg-gray-100 font-semibold py-2 px-4 border rounded border-gray-400 shadow"},"Register"))])}var L=o(6265),M=o.n(L),_={data(){return{username:"",password:"",loginFlag:!0,errorMessage:""}},props:{csrfToken:String},methods:{login(){const e="http://localhost:5000/login",t={headers:{"Content-Type":"application/json","X-CSRFToken":this.csrfToken},withCredentials:"include"};M().post(e,{username:this.username,password:this.password},t).then((()=>{this.$emit("login")})).catch((e=>{"Invalid username or password"==e.response.data.message&&this.setErrorMessage("Invalid username or password")}))},register(){const e="http://localhost:5000/register";M().post(e,{username:this.username,password:this.password}).then((()=>{this.$emit("register"),this.username="",this.password=""})).catch((e=>{"Username taken"==e.response.data.message&&this.setErrorMessage("Username taken")}))},setErrorMessage(e){this.errorMessage=e,setTimeout((()=>{this.errorMessage=""}),3e3)},toggleLogin(){this.loginFlag=!this.loginFlag}}};const O=(0,k.Z)(_,[["render",S],["__scopeId","data-v-3a02fd90"]]);var F=O;const R=e=>((0,s.dD)("data-v-05a419ef"),e=e(),(0,s.Cn)(),e),j={id:"mapContainer"},E=R((()=>(0,s._)("div",{id:"mapElement"},null,-1))),I=[E];function N(e,t,o,n,i,r){return(0,s.wg)(),(0,s.iD)("div",j,I)}var U=o(7709),z=o.n(U),X={name:"NoteMap",data(){return{map:null,pointToSet:null}},created(){this.renderMap()},methods:{renderMap(){let e=this;(0,s.Y3)((function(){z().accessToken="pk.eyJ1IjoianNhbmNoOTgiLCJhIjoiY2w1Z3Q1Yzc4MDJiODNrdGVqd3Rtb2V5OSJ9.GYwWTRDCQn85XZVUEU76EA";let t=new(z().Map)({container:"mapElement",projection:"globe",style:"mapbox://styles/mapbox/streets-v11",center:[-2.47657,51.279816],zoom:13});e.map=t;const o={type:"FeatureCollection",features:[]};t.on("load",(()=>{t=e.map,t.addSource("geojson",{type:"geojson",data:o}),t.addLayer({id:"point",type:"circle",source:"geojson",paint:{"circle-radius":7,"circle-color":"#070808"},filter:["in","$type","Point"]}),t.on("click",(n=>{o.features.length>=1&&o.features.pop();const s=t.queryRenderedFeatures(n.point);if(!s.length){const t={type:"Feature",geometry:{type:"Point",coordinates:[n.lngLat.lng,n.lngLat.lat]},properties:{id:String((new Date).getTime())}};o.features.push(t);const s=document.createElement("div");s.style.backgroundImage="url(/images/placeholder.png)",s.style.width="40px",s.style.height="40px",s.style.backgroundSize="100%",s.className="marker",e.pointToSet=t,e.$emit("setPoint",t);let i=document.createElement("div");i.style.width="$100px",i.style.height="$100px",i.appendChild(document.createElement("br"));let r=document.createElement("button");r.innerHTML="request to join button",i.appendChild(document.createElement("br")),i.appendChild(r);let a=(new(z().Popup)).setDOMContent(i).setLngLat([n.lngLat.lng,n.lngLat.lat]);const l=new(z().Marker)(s).setLngLat([n.lngLat.lng,n.lngLat.lat]).addTo(e.map);s.addEventListener("click",(()=>{l.setPopup(a)}))}}))}))}))}}};const $=(0,k.Z)(X,[["render",N],["__scopeId","data-v-05a419ef"]]);var q=$;const J="http://localhost:5000/";var V={name:"App",components:{BlogPost:T,LoginPage:F,NoteMap:q},data(){return{blogPosts:[],list:["one","two"],msg:"ms",text:"",loggedin:!1,csrfToken:"",statusMessage:"",axiosConfig:{headers:{"X-CSRFToken":this.csrfToken},withCredentials:!0},pointToSet:null}},created(){this.fetchCSRFToken(),this.loggedin&&this.loadPosts()},methods:{deletePost(e,t){const o="http://localhost:5000/deletepost";this.blogPosts.splice(e,1),M().post(o,{postID:t},{headers:{"X-CSRFToken":this.csrfToken},withCredentials:!0}).then((()=>{})).catch((()=>{this.statusMessage="Delete Failed",this.loadPosts()}))},addPost(e){if(e.preventDefault(),alert(null!=this.pointToSet),""==this.text||null==this.pointToSet)return alert("failed"),void this.timeoutStatusMessage("Please choose a location for this post");{const e="http://localhost:5000/addpost";M().post(e,{text:this.text,id:1,coordinates:JSON.stringify(this.pointToSet.geometry.coordinates)},{headers:{"X-CSRFToken":this.csrfToken},withCredentials:!0}).then((e=>{this.blogPosts.push({text:e.data.text,ID:e.data.ID}),this.text=""})).catch((e=>{alert(e)}))}},loadPosts(){const e="http://localhost:5000/posts";M().get(e,{headers:{"X-CSRFToken":this.csrfToken},withCredentials:!0}).then((e=>{this.blogPosts=e.data,this.loggedin=!0})).catch((e=>{alert("here "+e.message)}))},loginLoad(){this.loadPosts()},logout(){const e="http://localhost:5000/logout";M().get(e,{headers:{"X-CSRFToken":this.csrfToken},withCredentials:!0}).then((()=>{this.loggedin=!1})).catch((e=>{alert("logout failed "+e.message)}))},fetchCSRFToken(){M().get(J+"/api/csrf",this.axiosConfig).then((e=>{this.csrfToken=e.headers["x-csrftoken"]})).catch((e=>{alert(e.message)}))},timeoutStatusMessage(e){this.statusMessage=e,setTimeout((()=>{this.statusMessage=""}),3e3)},setPoint(e){this.pointToSet=e}}};const Z=(0,k.Z)(V,[["render",w]]);var Y=Z;(0,n.ri)(Y).mount("#app")}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,o),i.exports}o.m=e,function(){var e=[];o.O=function(t,n,s,i){if(!n){var r=1/0;for(u=0;u<e.length;u++){n=e[u][0],s=e[u][1],i=e[u][2];for(var a=!0,l=0;l<n.length;l++)(!1&i||r>=i)&&Object.keys(o.O).every((function(e){return o.O[e](n[l])}))?n.splice(l--,1):(a=!1,i<r&&(r=i));if(a){e.splice(u--,1);var d=s();void 0!==d&&(t=d)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[n,s,i]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,n){var s,i,r=n[0],a=n[1],l=n[2],d=0;if(r.some((function(t){return 0!==e[t]}))){for(s in a)o.o(a,s)&&(o.m[s]=a[s]);if(l)var u=l(o)}for(t&&t(n);d<r.length;d++)i=r[d],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return o.O(u)},n=self["webpackChunkflask_frontend2"]=self["webpackChunkflask_frontend2"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=o.O(void 0,[998],(function(){return o(5839)}));n=o.O(n)})();
//# sourceMappingURL=app.fc2f5dba.js.map